"use strict";(self.webpackChunkcse335=self.webpackChunkcse335||[]).push([[70],{48620:(e,t,n)=>{var s=n(34802),r={class:"content cl-users-editor"},l={class:"full"},o={key:0},i={key:0,class:"small"},a=(0,s._)("tr",null,[(0,s._)("th",{scope:"col"}," "),(0,s._)("th",{scope:"col"},"User"),(0,s._)("th",{scope:"col"},"Name"),(0,s._)("th",{scope:"col"},"Email"),(0,s._)("th",{scope:"col"},"Role")],-1),u={key:0},c=["src"],m=["onClick"],p=["src"],d={key:1},f={key:2},h={key:3},v=["onClick"],g=["src"],_={key:4},w=["onClick"],U={key:5},k=["onClick"],y={key:1,class:"centerbox comp center"};var b=n(94975),S=n(27946),$=Site.Vuex.mapState;const D={extends:Site.ConsoleComponentBase,props:["management"],data:function(){return{root:Site.root,pencil:Site.root+"/vendor/cl/site/img/pencil16.png",deleter:Site.root+"/vendor/cl/site/img/x.png",info:Site.root+"/vendor/cl/site/img/info16.png",toUser:function(e){return Site.root+"/cl/console/management/user/"+e.id}}},methods:{fetchMore:function(){this.$store.dispatch("users/more")},deleteUser:function(e){var t=this;new b.Z.MessageBox("Are you sure?","Are you sure you want to delete "+e.name,b.Z.MessageBox.OKCANCEL,(function(){t.$store.dispatch("users/delete",{id:e.id})}))},presentUser:function(e){var t='<div class="cl-dialog">\n<div class="tabular">\n<p><span class="label">User ID: </span><span>'.concat(e.userId,'</span></p>\n<p><span class="label">Name: </span><span>').concat(e.name,'</span></p>\n<p><span class="label">Email: </span><span>').concat(e.email,'</span></p>\n<p><span class="label">Role: </span><span>').concat(e.userRoleName(),"</span></p>\n</div>\n</div>");new b.Z({content:t})}},computed:$({users:function(e){return e.users.users},fetcher:function(e){return e.users.fetcher}}),mounted:function(){var e=this;this.$root.setTitle(": Users"),this.$store.dispatch("users/fetch"),this.management?this.addComponent=this.$root.console.components.addNav2Link(this,"Add User",5,(function(){e.$router.push(Site.root+"/cl/console/management/user/new")})):this.addComponent=null},beforeUnmount:function(){this.addComponent&&this.$root.console.components.removeNav2(this,this.addComponent)},components:{fetcher:S.Z}};var M=n(17944);const C=(0,M.Z)(D,[["render",function(e,t,n,b,S,$){var D=(0,s.up)("router-link"),M=(0,s.up)("fetcher");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",l,[e.fetcher.fetched?((0,s.wg)(),(0,s.iD)("div",o,[e.users.length>0?((0,s.wg)(),(0,s.iD)("table",i,[a,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.users,(function(t){return(0,s.wg)(),(0,s.iD)("tr",null,[n.management?((0,s.wg)(),(0,s.iD)("td",u,[(0,s.Wm)(D,{to:e.toUser(t)},{default:(0,s.w5)((function(){return[(0,s._)("img",{src:e.pencil,alt:"Edit",title:"Edit"},null,8,c)]})),_:2},1032,["to"]),(0,s._)("a",{href:"javascript:",onClick:(0,s.iM)((function(e){return $.deleteUser(t)}),["prevent"])},[(0,s._)("img",{src:e.deleter,alt:"Delete",title:"Delete"},null,8,p)],8,m)])):(0,s.kq)("v-if",!0),n.management?((0,s.wg)(),(0,s.iD)("td",d,[(0,s.Wm)(D,{to:e.toUser(t)},{default:(0,s.w5)((function(){return[(0,s.Uk)((0,s.zw)(t.userId),1)]})),_:2},1032,["to"])])):(0,s.kq)("v-if",!0),n.management?((0,s.wg)(),(0,s.iD)("td",f,[(0,s.Wm)(D,{to:e.toUser(t)},{default:(0,s.w5)((function(){return[(0,s.Uk)((0,s.zw)(t.name),1)]})),_:2},1032,["to"])])):(0,s.kq)("v-if",!0),n.management?(0,s.kq)("v-if",!0):((0,s.wg)(),(0,s.iD)("td",h,[(0,s._)("a",{onClick:(0,s.iM)((function(e){return $.presentUser(t)}),["prevent"]),href:"javascript:;"},[(0,s._)("img",{src:e.info,alt:"View",title:"View"},null,8,g)],8,v)])),n.management?(0,s.kq)("v-if",!0):((0,s.wg)(),(0,s.iD)("td",_,[(0,s._)("a",{onClick:(0,s.iM)((function(e){return $.presentUser(t)}),["prevent"]),href:"javascript:;"},(0,s.zw)(t.userId),9,w)])),n.management?(0,s.kq)("v-if",!0):((0,s.wg)(),(0,s.iD)("td",U,[(0,s._)("a",{onClick:(0,s.iM)((function(e){return $.presentUser(t)}),["prevent"]),href:"javascript:;"},(0,s.zw)(t.name),9,k)])),(0,s._)("td",null,(0,s.zw)(t.email),1),(0,s._)("td",null,(0,s.zw)(t.userRoleName()),1)])})),256))])):(0,s.kq)("v-if",!0),0==e.users.length?((0,s.wg)(),(0,s.iD)("p",y," There are currently no users in the system.")):(0,s.kq)("v-if",!0)])):(0,s.kq)("v-if",!0),(0,s.Wm)(M,{fetcher:e.fetcher},null,8,["fetcher"])])])}]]);var q={class:"cl-user-editor content"},x={class:"full"},I=(0,s._)("br",null,null,-1),L={class:"form_text"},A=(0,s._)("span",{class:"small"},"(last, first)",-1),E=(0,s._)("br",null,null,-1),N={class:"form_text"},T=(0,s._)("br",null,null,-1),z={class:"cl-radio-set"},R=(0,s._)("div",{class:"label"},[(0,s._)("em",null,"Role:")],-1),V={class:"options"},O=["value"],Z=(0,s._)("br",null,null,-1),j={class:"form_text"},P=(0,s._)("br",null,null,-1),W={class:"center"},H=(0,s._)("button",null,"Submit",-1),K=(0,s._)("p",{class:"error"}," ",-1);const B={props:["user"],data:function(){return{link:""}},watch:{user:function(){var e=this.user,t=this.link;null!==e&&void 0!==e.prev?this.$root.console.components.nav2left={template:'<router-link title="Previous User" :to="link + user.prev.id"><img :src="icon" alt="Previous User"></router-link>',data:function(){return{icon:Site.root+"/vendor/cl/site/img/previcon.png",user:e,link:t}}}:this.$root.console.components.nav2left=null,null!==e&&void 0!==e.next?this.$root.console.components.nav2right={template:'<router-link title="Next User" :to="link + user.next.id"><img :src="icon" alt="Next User"></router-link>',data:function(){return{icon:Site.root+"/vendor/cl/site/img/nexticon.png",user:e,link:t}}}:this.$root.console.components.nav2right=null}},mounted:function(){var e=this.$route.path.match(/(^.*)\/([0-9]+)$/);null!==e&&(this.link=e[1]+"/")},beforeUnmount:function(){this.$root.console.components.nav2left=null,this.$root.console.components.nav2right=null}},F=(0,M.Z)(B,[["render",function(e,t,n,r,l,o){return(0,s.wg)(),(0,s.iD)("div")}]]);const Y={props:["id"],data:function(){return{cancel:Site.root+"/cl/console/management/users",legend:"new"===this.id?"New User":"Edit User",roles:Site.User.getUserRoles(),user:null,userId:"",name:"",email:"",role:"",password1:"",password2:""}},computed:(0,n(97818).rn)({fetcher:function(e){return e.users.fetcher}}),components:{fetcher:S.Z,prevNext:F},watch:{$route:function(e,t){this.take()}},mounted:function(){this.take()},methods:{take:function(){var e=this;"new"===this.id?(this.$root.setTitle(": Add User"),this.role=Site.User.USER,this.$nextTick((function(){e.$refs.userid.select()})),this.user=null):(this.$root.setTitle(": User"),this.$store.dispatch("users/get",{id:this.id}).then((function(t){e.user=t,e.userId=t.userId,e.name=t.name,e.$root.setTitle(": User "+t.name),e.email=t.email,e.role=t.userRole(),e.$nextTick((function(){e.$refs.userid.select()}))})).catch((function(t){Site.toast(e,t),setTimeout((function(){e.$router.push({name:"users"})}),3e3)})))},submit:function(){var e=this,t={userId:this.userId,name:this.name,email:this.email,role:this.role,password1:this.password1,password2:this.password2};"new"!==this.id&&(t.id=this.id);var n="new"===this.id?"users/new":"users/update";this.$store.dispatch(n,t).then((function(){e.$router.push({name:"users"})})).catch((function(t){switch(Site.toast(e,t),t.errorCode()){case Site.Users.MUST_PROVIDE_USERID_OR_EMAIL:e.$refs.userid.focus();break;case Site.Users.PASSWORDS_MUST_MATCH:e.$refs.password1.focus();break;case Site.Users.DUPLICATE_EMAIL:e.$refs.email.focus();break;case Site.Users.DUPLICATE_USER:e.$refs.userid.focus()}}))},cancel1:function(){this.$router.push({name:"users"})}}},G=(0,M.Z)(Y,[["render",function(e,t,n,r,l,o){var i=(0,s.up)("prev-next"),a=(0,s.up)("fetcher");return(0,s.wg)(),(0,s.iD)("div",q,[(0,s._)("div",x,[(0,s.Wm)(i,{user:e.user},null,8,["user"]),(0,s.Wm)(a,{fetcher:e.fetcher},null,8,["fetcher"]),(0,s._)("div",null,[(0,s._)("form",{class:"cl-common",onSubmit:t[7]||(t[7]=(0,s.iM)((function(){return o.submit&&o.submit.apply(o,arguments)}),["prevent"]))},[(0,s._)("fieldset",null,[(0,s._)("legend",null,(0,s.zw)(e.legend),1),(0,s._)("p",null,[(0,s._)("label",null,[(0,s.Uk)("User ID"),I,(0,s.wy)((0,s._)("input",{ref:"userid",type:"text","onUpdate:modelValue":t[0]||(t[0]=function(t){return e.userId=t}),class:"short",size:"20",maxlength:"30",spellcheck:"false"},null,512),[[s.nr,e.userId]])])]),(0,s._)("p",null,[(0,s._)("label",L,[(0,s.Uk)("Name "),A,E,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.name=t}),maxlength:"150"},null,512),[[s.nr,e.name]])])]),(0,s._)("p",null,[(0,s._)("label",N,[(0,s.Uk)("Email"),T,(0,s.wy)((0,s._)("input",{ref:"email",type:"email","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.email=t}),maxlength:"254"},null,512),[[s.nr,e.email]])])]),(0,s._)("div",z,[R,(0,s._)("div",V,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.roles,(function(n,r){return(0,s.wg)(),(0,s.iD)("label",null,[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.role=t}),name:"role",type:"radio",value:r},null,8,O),[[s.G2,e.role]]),(0,s.Uk)((0,s.zw)(n.name),1)])})),256))])]),(0,s._)("p",null,[(0,s._)("label",null,[(0,s.Uk)("Password"),Z,(0,s.wy)((0,s._)("input",{ref:"password1",type:"password","onUpdate:modelValue":t[4]||(t[4]=function(t){return e.password1=t}),class:"medium"},null,512),[[s.nr,e.password1]])])]),(0,s._)("p",null,[(0,s._)("label",j,[(0,s.Uk)("Again"),P,(0,s.wy)((0,s._)("input",{type:"password","onUpdate:modelValue":t[5]||(t[5]=function(t){return e.password2=t}),class:"medium"},null,512),[[s.nr,e.password2]])])]),(0,s._)("p",W,[H,(0,s.Uk)("  "),(0,s._)("button",{onClick:t[6]||(t[6]=(0,s.iM)((function(){return o.cancel1&&o.cancel1.apply(o,arguments)}),["prevent"]))},"Cancel")]),K])],32)])])])}]]);var Q={class:"content"},X={class:"full"},J={class:"center"},ee=(0,s._)("option",{value:"0"}," ",-1),te=["value"],ne={key:0,class:"small"},se=(0,s._)("tr",null,[(0,s._)("th",null,"Time"),(0,s._)("th",null,"Sys"),(0,s._)("th",null,"Level"),(0,s._)("th",null,"Message"),(0,s._)("th",null,"User"),(0,s._)("th",null,"Ids"),(0,s._)("th",null,"Context")],-1),re={class:"small"},le={class:"small"},oe={key:1,class:"center"},ie=[(0,s._)("em",null,"** empty **",-1)],ae={key:2,class:"cl-more"};function ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw l}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}const me={extends:Site.ConsoleComponentBase,data:function(){return{results:[],more:!1,levels:[],qLevel:0,qUser:"",qMessage:""}},mounted:function(){for(var e in this.$root.setTitle(": Site Logs"),this.$site.LogLevels)this.levels.push({value:e,name:this.$site.LogLevels[e]});this.levels.sort((function(e,t){return e.level-t.level})),this.fetch()},methods:{query:function(){this.results=[],this.fetch()},fetch:function(){var e=this,t={};this.results.length>0&&(t.before=this.results[this.results.length-1].time),0!=+this.qLevel&&(t.level=this.qLevel),""!==this.qUser.trim()&&(t.name=this.qUser.trim()),""!==this.qMessage.trim()&&(t.message=this.qMessage.trim()),this.$site.api.get("/api/site/logs",t).then((function(t){if(t.hasError())e.$site.toast(e,t);else{var n=t.getData("site-log");if(null!==n){var s,r=ue(n.attributes.results);try{for(r.s();!(s=r.n()).done;){var l=s.value;e.results.push(l)}}catch(e){r.e(e)}finally{r.f()}e.more=n.attributes.more}}})).catch((function(t){console.log(t),e.$site.toast(e,t)}))},getMore:function(){this.fetch()},time:function(e){return this.$site.TimeFormatter.relativeUNIX(e)},ids:function(e){var t="";return null!==e.userid&&(t+=e.userid),null!==e.memberid&&(t+="/"+e.userid),t},levelName:function(e){var t=this.$site.LogLevels;return void 0!==t[e]?t[e]:"UNDEFINED"}}},pe=(0,M.Z)(me,[["render",function(e,t,n,r,l,o){return(0,s.wg)(),(0,s.iD)("div",Q,[(0,s._)("div",X,[(0,s._)("form",null,[(0,s._)("p",J,[(0,s.wy)((0,s._)("select",{"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.qLevel=t}),onChange:t[1]||(t[1]=(0,s.iM)((function(){return o.query&&o.query.apply(o,arguments)}),["prevent"]))},[ee,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.levels,(function(e){return(0,s.wg)(),(0,s.iD)("option",{value:e.value},(0,s.zw)(e.name),9,te)})),256))],544),[[s.bM,e.qLevel]]),(0,s._)("label",null,[(0,s.Uk)("User: "),(0,s.wy)((0,s._)("input",{type:"text",spellcheck:"false","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.qUser=t})},null,512),[[s.nr,e.qUser]])]),(0,s._)("label",null,[(0,s.Uk)("Message: "),(0,s.wy)((0,s._)("input",{type:"text",spellcheck:"false","onUpdate:modelValue":t[3]||(t[3]=function(t){return e.qMessage=t})},null,512),[[s.nr,e.qMessage]])]),(0,s._)("button",{onClick:t[4]||(t[4]=(0,s.iM)((function(){return o.query&&o.query.apply(o,arguments)}),["prevent"]))},"Query")])]),e.results.length>0?((0,s.wg)(),(0,s.iD)("table",ne,[se,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.results,(function(e){return(0,s.wg)(),(0,s.iD)("tr",null,[(0,s._)("td",re,(0,s.zw)(o.time(e.time)),1),(0,s._)("td",null,(0,s.zw)(e.channel),1),(0,s._)("td",null,(0,s.zw)(o.levelName(e.level)),1),(0,s._)("td",null,(0,s.zw)(e.message),1),(0,s._)("td",null,(0,s.zw)(e.name),1),(0,s._)("td",null,(0,s.zw)(o.ids(e)),1),(0,s._)("td",le,(0,s.zw)(e.context),1)])})),256))])):((0,s.wg)(),(0,s.iD)("p",oe,ie)),e.more?((0,s.wg)(),(0,s.iD)("p",ae,[(0,s._)("a",{onClick:t[5]||(t[5]=function(){return o.getMore&&o.getMore.apply(o,arguments)})},"more")])):(0,s.kq)("v-if",!0)])])}]]);var de=n(43290);Site.UsersConsole||(Site.UsersConsole=new function(e){var t=e.console;t.tables.add({title:"Users",order:10,api:"/api/users/tables"}),t.components.addOption({atLeast:Site.User.STAFF,page:{title:"Main",route:"",order:1},section:{title:"Site",order:1},title:"Users",order:1,route:"/users",routes:[{route:"/users",component:C,props:{management:!1}}]}),t.components.addOption({atLeast:Site.User.ADMIN,page:{title:"Management",route:"/management",order:10},section:{title:"Site Management",order:1},title:"Users",order:1,route:"/management/users",routes:[{route:"/management/users",name:"users",component:C,props:{management:!0}},{route:"/management/user/:id",name:"user",component:G,props:!0}]}),t.components.addOption({atLeast:{tag:"site-log",default:de.n.ADMIN},page:{title:"Management",route:"/management",order:10},section:{title:"Site Management",order:1},title:"Logs",order:2,route:"/management/logs",routes:[{route:"/management/logs",name:"logs",component:pe}]})}(Site))}},e=>{e.O(0,[592,736,828,530],(()=>{return t=48620,e(e.s=t);var t}));e.O()}]);